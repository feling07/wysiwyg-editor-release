/*
 froala_editor v3.2.5 (https://www.froala.com/wysiwyg-editor)
 License https://froala.com/wysiwyg-editor/terms/
 Copyright 2014-2020 Froala Labs
*/
!function(g,M){"object"==typeof exports&&"undefined"!=typeof module?M(require("froala-editor")):"function"==typeof define&&define.amd?define(["froala-editor"],M):M(g.FroalaEditor)}(this,function(g){function M(a){return(M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(p){return typeof p}:function(p){return p&&"function"==typeof Symbol&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p})(a)}g=g&&g.hasOwnProperty("default")?g["default"]:g;Object.assign(g.POPUP_TEMPLATES,
    {"image.insert":"[_BUTTONS_][_UPLOAD_LAYER_][_BY_URL_LAYER_][_PROGRESS_BAR_]","image.edit":"[_BUTTONS_]","image.alt":"[_BUTTONS_][_ALT_LAYER_]","image.size":"[_BUTTONS_][_SIZE_LAYER_]"});Object.assign(g.DEFAULTS,{imageInsertButtons:["imageBack","|","imageUpload","imageByURL"],imageEditButtons:"imageReplace imageAlign imageCaption imageRemove imageLink linkOpen linkEdit linkRemove - imageDisplay imageStyle imageAlt imageSize".split(" "),imageAltButtons:["imageBack","|"],imageSizeButtons:["imageBack",
    "|"],imageUpload:!0,imageUploadURL:null,imageCORSProxy:"https://cors-anywhere.froala.com",imageUploadRemoteUrls:!0,imageUploadParam:"file",imageUploadParams:{},imageUploadToS3:!1,imageUploadToAzure:!1,imageUploadMethod:"POST",imageMaxSize:10485760,imageAllowedTypes:["jpeg","jpg","png","gif","webp"],imageResize:!0,imageResizeWithPercent:!1,imageRoundPercent:!1,imageDefaultWidth:300,imageDefaultAlign:"center",imageDefaultDisplay:"block",imageSplitHTML:!1,imageStyles:{"fr-rounded":"Rounded","fr-bordered":"Bordered",
    "fr-shadow":"Shadow"},imageMove:!0,imageMultipleStyles:!0,imageTextNear:!0,imagePaste:!0,imagePasteProcess:!1,imageMinWidth:16,imageOutputSize:!1,imageDefaultMargin:5,imageAddNewLine:!1});g.PLUGINS.image=function(a){function p(){var b=a.popups.get("image.insert").find(".fr-image-by-url-layer input");b.val("");e&&b.val(e.attr("src"));b.trigger("change")}function t(){var b=a.popups.get("image.edit");if(b||(b=pa()),b){b=w();x()&&(b=b.find(".fr-img-wrap"));a.popups.setContainer("image.edit",a.$sc);a.popups.refresh("image.edit");
    var c=b.offset().left+b.outerWidth()/2,d=b.offset().top+b.outerHeight();e.hasClass("fr-uploading")?G():a.popups.show("image.edit",c,d,b.outerHeight(),!0)}}function I(){N()}function L(){for(var b,c="IMG"==a.el.tagName?[a.el]:a.el.querySelectorAll("img"),d=0;d<c.length;d++){var f=k(c[d]);if(!a.opts.htmlUntouched&&a.opts.useClasses)(a.opts.imageDefaultAlign||a.opts.imageDefaultDisplay)&&(0<(b=f).parents(".fr-img-caption").length&&(b=b.parents(".fr-img-caption").first()),b.hasClass("fr-dii")||b.hasClass("fr-dib")||
    (b.addClass("fr-fi".concat(T(b)[0])),b.addClass("fr-di".concat(ka(b)[0])),b.css("margin",""),b.css("float",""),b.css("display",""),b.css("z-index",""),b.css("position",""),b.css("overflow",""),b.css("vertical-align",""))),a.opts.imageTextNear||(0<f.parents(".fr-img-caption").length?f.parents(".fr-img-caption").first().removeClass("fr-dii").addClass("fr-dib"):f.removeClass("fr-dii").addClass("fr-dib"));else if(!a.opts.htmlUntouched&&!a.opts.useClasses&&(a.opts.imageDefaultAlign||a.opts.imageDefaultDisplay)){var h=
    f;0<h.parents(".fr-img-caption").length&&(h=h.parents(".fr-img-caption").first());var l=h.hasClass("fr-dib")?"block":h.hasClass("fr-dii")?"inline":null,m=h.hasClass("fr-fil")?"left":h.hasClass("fr-fir")?"right":T(h);P(h,l,m);h.removeClass("fr-dib fr-dii fr-fir fr-fil")}a.opts.iframe&&f.on("load",a.size.syncIframe)}}function aa(b){void 0===b&&(b=!0);var c,d=Array.prototype.slice.call(a.el.querySelectorAll("img")),f=[];for(c=0;c<d.length;c++)if(f.push(d[c].getAttribute("src")),k(d[c]).toggleClass("fr-draggable",
    a.opts.imageMove),""===d[c].getAttribute("class")&&d[c].removeAttribute("class"),""===d[c].getAttribute("style")&&d[c].removeAttribute("style"),d[c].parentNode&&d[c].parentNode.parentNode&&a.node.hasClass(d[c].parentNode.parentNode,"fr-img-caption")){var h=d[c].parentNode.parentNode;a.browser.mozilla||h.setAttribute("contenteditable",!1);h.setAttribute("draggable",!1);h.classList.add("fr-draggable");(h=d[c].nextSibling)&&!a.browser.mozilla&&h.setAttribute("contenteditable",!0)}if(J)for(c=0;c<J.length;c++)0>
    f.indexOf(J[c].getAttribute("src"))&&a.events.trigger("image.removed",[k(J[c])]);if(J&&b){b=[];for(c=0;c<J.length;c++)b.push(J[c].getAttribute("src"));for(c=0;c<d.length;c++)0>b.indexOf(d[c].getAttribute("src"))&&a.events.trigger("image.loaded",[k(d[c])])}J=d}function K(){if(u||function(){var l;a.shared.$image_resizer?(u=a.shared.$image_resizer,H=a.shared.$img_overlay,a.events.on("destroy",function(){k("body").first().append(u.removeClass("fr-active"))},!0)):(a.shared.$image_resizer=k(document.createElement("div")).attr("class",
    "fr-image-resizer"),u=a.shared.$image_resizer,a.events.$on(u,"mousedown",function(n){n.stopPropagation()},!0),a.opts.imageResize&&(u.append(ba("nw")+ba("ne")+ba("sw")+ba("se")),a.shared.$img_overlay=k(document.createElement("div")).attr("class","fr-image-overlay"),H=a.shared.$img_overlay,l=u.get(0).ownerDocument,k(l).find("body").first().append(H)));a.events.on("shared.destroy",function(){u.html("").removeData().remove();u=null;a.opts.imageResize&&(H.remove(),H=null)},!0);a.helpers.isMobile()||a.events.$on(k(a.o_win),
    "resize",function(){e&&!e.hasClass("fr-uploading")?y(!0):e&&(K(),ca(),G(!1))});if(a.opts.imageResize){l=u.get(0).ownerDocument;a.events.$on(u,a._mousedown,".fr-handler",qa);a.events.$on(k(l),a._mousemove,ra);a.events.$on(k(l.defaultView||l.parentWindow),a._mouseup,la);a.events.$on(H,"mouseleave",la);var m=1,r=null,q=0;a.events.on("keydown",function(n){if(e){var v=-1!=navigator.userAgent.indexOf("Mac OS X")?n.metaKey:n.ctrlKey,D=n.which;(D!==r||200<n.timeStamp-q)&&(m=1);(D==g.KEYCODE.EQUALS||a.browser.mozilla&&
    D==g.KEYCODE.FF_EQUALS)&&v&&!n.altKey?m=sa.call(this,n,1,1,m):(D==g.KEYCODE.HYPHEN||a.browser.mozilla&&D==g.KEYCODE.FF_HYPHEN)&&v&&!n.altKey?m=sa.call(this,n,2,-1,m):a.keys.ctrlKey(n)||D!=g.KEYCODE.ENTER||(e.before("<br>"),B(e));r=D;q=n.timeStamp}},!0);a.events.on("keyup",function(){m=1})}}(),!e)return!1;var b=a.$wp||a.$sc;b.append(u);u.data("instance",a);var c=b.scrollTop()-("static"!=b.css("position")?b.offset().top:0),d=b.scrollLeft()-("static"!=b.css("position")?b.offset().left:0);d-=a.helpers.getPX(b.css("border-left-width"));
    c-=a.helpers.getPX(b.css("border-top-width"));a.$el.is("img")&&a.$sc.is("body")&&(d=c=0);b=w();x()&&(b=b.find(".fr-img-wrap"));var f=0,h=0;a.opts.iframe&&(f=a.helpers.getPX(a.$wp.find(".fr-iframe").css("padding-top")),h=a.helpers.getPX(a.$wp.find(".fr-iframe").css("padding-left")));u.css("top",(a.opts.iframe?b.offset().top+f:b.offset().top+c)-1).css("left",(a.opts.iframe?b.offset().left+h:b.offset().left+d)-1).css("width",b.get(0).getBoundingClientRect().width).css("height",b.get(0).getBoundingClientRect().height).addClass("fr-active")}
    function ba(b){return'<div class="fr-handler fr-h'.concat(b,'"></div>')}function U(b){x()?e.parents(".fr-img-caption").css("width",b):e.css("width",b)}function qa(b){if(!a.core.sameInstance(u))return!0;if(b.preventDefault(),b.stopPropagation(),a.$el.find("img.fr-error").left)return!1;a.undo.canDo()||a.undo.saveStep();var c=b.pageX||b.originalEvent.touches[0].pageX;if("mousedown"==b.type){b=a.$oel.get(0).ownerDocument;b=b.defaultView||b.parentWindow;var d=!1;try{d=b.location!=b.parent.location&&!(b.$&&
    b.$.FE)}catch(f){}d&&b.frameElement&&(c+=a.helpers.getPX(k(b.frameElement).offset().left)+b.frameElement.clientLeft)}(C=k(this)).data("start-x",c);C.data("start-width",e.width());C.data("start-height",e.height());c=e.width();a.opts.imageResizeWithPercent&&(b=e.parentsUntil(a.$el,a.html.blockTagsQuery()).get(0)||a.el,c=(c/k(b).outerWidth()*100).toFixed(2)+"%");U(c);H.show();a.popups.hideAll();Q=!1}function ra(b){if(!a.core.sameInstance(u))return!0;var c;if(C&&e){if(b.preventDefault(),a.$el.find("img.fr-error").left)return!1;
    b=b.pageX||(b.originalEvent.touches?b.originalEvent.touches[0].pageX:null);if(!b)return!1;b-=C.data("start-x");var d=C.data("start-width");if((C.hasClass("fr-hnw")||C.hasClass("fr-hsw"))&&(b=0-b),a.opts.imageResizeWithPercent){var f=e.parentsUntil(a.$el,a.html.blockTagsQuery()).get(0)||a.el;d=((d+b)/k(f).outerWidth()*100).toFixed(2);a.opts.imageRoundPercent&&(d=Math.round(d));U("".concat(d,"%"));(c=x()?(a.helpers.getPX(e.parents(".fr-img-caption").css("width"))/k(f).outerWidth()*100).toFixed(2):(a.helpers.getPX(e.css("width"))/
    k(f).outerWidth()*100).toFixed(2))===d||a.opts.imageRoundPercent||U("".concat(c,"%"));e.css("height","").removeAttr("height")}else d+b>=a.opts.imageMinWidth&&(U(d+b),c=x()?a.helpers.getPX(e.parents(".fr-img-caption").css("width")):a.helpers.getPX(e.css("width"))),c!==d+b&&U(c),((e.attr("style")||"").match(/(^height:)|(; *height:)/)||e.attr("height"))&&(e.css("height",C.data("start-height")*e.width()/C.data("start-width")),e.removeAttr("height"));K();a.events.trigger("image.resize",[e])}}function la(b){if(!a.core.sameInstance(u))return!0;
    if(C&&e){if(b&&b.stopPropagation(),a.$el.find("img.fr-error").left)return!1;C=null;H.hide();K();t();a.undo.saveStep();a.events.trigger("image.resizeEnd",[e])}else u.removeClass("fr-active")}function E(b,c,d){a.edit.on();e&&e.addClass("fr-error");da[b]?ta(a.language.translate(da[b])):ta(a.language.translate("Something went wrong. Please try again."));!e&&d&&ea(d);a.events.trigger("image.error",[{code:b,message:da[b]},c,d])}function pa(b){if(b)return a.$wp&&a.events.$on(a.$wp,"scroll.image-edit",function(){e&&
    a.popups.isVisible("image.edit")&&(a.events.disableBlur(),t())}),!0;b="";if(0<a.opts.imageEditButtons.length){var c={buttons:b+='<div class="fr-buttons"> \n        '.concat(a.button.buildList(a.opts.imageEditButtons),"\n        </div>")};return a.popups.create("image.edit",c)}return!1}function G(b){var c=a.popups.get("image.insert");if(c||(c=V()),c.find(".fr-layer.fr-active").removeClass("fr-active").addClass("fr-pactive"),c.find(".fr-image-progress-bar-layer").addClass("fr-active"),c.find(".fr-buttons").hide(),
    e){c=w();a.popups.setContainer("image.insert",a.$sc);var d=c.offset().left,f=c.offset().top+c.height();a.popups.show("image.insert",d,f,c.outerHeight())}void 0===b&&W(a.language.translate("Uploading"),0)}function N(b){var c=a.popups.get("image.insert");if(c&&(c.find(".fr-layer.fr-pactive").addClass("fr-active").removeClass("fr-pactive"),c.find(".fr-image-progress-bar-layer").removeClass("fr-active"),c.find(".fr-buttons").show(),b||a.$el.find("img.fr-error").length)){if(a.events.focus(),a.$el.find("img.fr-error").length&&
    (a.$el.find("img.fr-error").remove(),a.undo.saveStep(),a.undo.run(),a.undo.dropRedo()),!a.$wp&&e)b=e,y(!0),a.selection.setAfter(b.get(0)),a.selection.restore();a.popups.hide("image.insert")}}function W(b,c){var d=a.popups.get("image.insert");d&&(d=d.find(".fr-image-progress-bar-layer"),d.find("h3").text(b+(c?" ".concat(c,"%"):"")),d.removeClass("fr-error"),c?(d.find("div").removeClass("fr-indeterminate"),d.find("div > span").css("width","".concat(c,"%"))):d.find("div").addClass("fr-indeterminate"))}
    function ta(b){G();var c=a.popups.get("image.insert").find(".fr-image-progress-bar-layer");c.addClass("fr-error");c=c.find("h3");c.text(b);a.events.disableBlur();c.focus()}function B(b){ua.call(b.get(0))}function va(){var b=k(this);a.popups.hide("image.insert");b.removeClass("fr-uploading");b.next().is("br")&&b.next().remove();B(b);a.events.trigger("image.loaded",[b])}function X(b,c,d,f,h){f&&"string"==typeof f&&(f=a.$(f));a.edit.off();W(a.language.translate("Loading image"));c&&(b=a.helpers.sanitizeURL(b));
    c=new Image;c.onload=function(){var l,m;if(f){a.undo.canDo()||f.hasClass("fr-uploading")||a.undo.saveStep();var r=f.data("fr-old-src");f.data("fr-image-pasted")&&(r=null);a.$wp?((l=f.clone().removeData("fr-old-src").removeClass("fr-uploading").removeAttr("data-fr-image-pasted")).off("load"),r&&f.attr("src",r),f.replaceWith(l)):l=f;console.log(l,l.get(0).attributes,"e");console.log(d,"s");console.log(b,l,d,f,h,"check");for(var q=l.get(0).attributes,n=0;n<q.length;n++){var v=q[n];v.nodeName.indexOf("data-");
    l.removeAttr(v.nodeName)}if(void 0!==d)for(m in d)d.hasOwnProperty(m)&&"link"!=m&&l.attr("".concat(m),d[m]);l.on("load",va);l.attr("src",b);a.edit.on();aa(!1);a.undo.saveStep();a.events.disableBlur();a.$el.blur();a.events.trigger(r?"image.replaced":"image.inserted",[l,h])}else l=wa(b,d,va),aa(!1),a.undo.saveStep(),a.events.disableBlur(),a.$el.blur(),a.events.trigger("image.inserted",[l,h])};c.onerror=function(){E(1)};G(a.language.translate("Loading image"));c.src=b}function Fa(b,c,d){W(a.language.translate("Loading image"));
    var f=this.status,h=this.response,l=this.responseXML,m=this.responseText;try{if(a.opts.imageUploadToS3||a.opts.imageUploadToAzure)if(201==f){if(a.opts.imageUploadToAzure){if(!1===a.events.trigger("image.uploadedToAzure",[this.responseURL,d,h],!0))return a.edit.on(),!1;var r=c}else r=function(n){try{var v=k(n).find("Location").text(),D=k(n).find("Key").text();return!1===a.events.trigger("image.uploadedToS3",[v,D,n],!0)?(a.edit.on(),!1):v}catch(F){return E(4,n),!1}}(l);r&&X(r,!1,[],b,h||l)}else E(4,
    h||l,b);else if(200<=f&&300>f){var q=function(n){try{if(!1===a.events.trigger("image.uploaded",[n],!0))return a.edit.on(),!1;var v=JSON.parse(n);return v.link?v:(E(2,n),!1)}catch(D){return E(4,n),!1}}(m);q&&X(q.link,!1,q,b,h||m)}else E(3,h||m,b)}catch(n){E(4,h||m,b)}}function Ga(){E(4,this.response||this.responseText||this.responseXML)}function Ha(b){b.lengthComputable&&(b=b.loaded/b.total*100|0,W(a.language.translate("Uploading"),b))}function wa(b,c,d){var f;b=k(document.createElement("img")).attr("src",
    b);if(c&&void 0!==c)for(f in c)c.hasOwnProperty(f)&&"link"!=f&&(" data-".concat(f,'="').concat(c[f],'"'),b.attr("".concat(f),c[f]));(c=a.opts.imageDefaultWidth)&&"auto"!=c&&(c=a.opts.imageResizeWithPercent?"100%":"".concat(c,"px"));b.attr("style",c?"width: ".concat(c,";"):"");P(b,a.opts.imageDefaultDisplay,a.opts.imageDefaultAlign);b.on("load",d);b.on("error",d);a.edit.on();a.events.focus(!0);a.selection.restore();a.undo.saveStep();a.opts.imageSplitHTML?a.markers.split():a.markers.insert();a.html.wrap();
    d=a.$el.find(".fr-marker");return d.length?(d.parent().is("hr")&&d.parent().after(d),a.node.isLastSibling(d)&&d.parent().hasClass("fr-deletable")&&d.insertAfter(d.parent()),d.replaceWith(b)):a.$el.append(b),a.selection.clear(),b}function Ia(){a.edit.on();N(!0)}function fa(b,c){if(void 0!==b&&0<b.length){if(!1===a.events.trigger("image.beforeUpload",[b,c]))return!1;var d,f=b[0];if(!(null!==a.opts.imageUploadURL&&"https://i.froala.com/upload"!=a.opts.imageUploadURL||a.opts.imageUploadToS3||a.opts.imageUploadToAzure))return function(F,
    R){var O=new FileReader;O.onload=function(){if(0>O.result.indexOf("svg+xml")){var z=atob(O.result.split(",")[1]);for(var ha=[],Y=0;Y<z.length;Y++)ha.push(z.charCodeAt(Y));z=window.URL.createObjectURL(new Blob([new Uint8Array(ha)],{type:F.type}));R&&R.data("fr-old-src",R.attr("src"));a.image.insert(z,!1,null,R)}};G();O.readAsDataURL(F)}(f,c||e),!1;if(f.name||(f.name=(new Date).getTime()+"."+(f.type||"image/jpeg").replace(/image\//g,"")),f.size>a.opts.imageMaxSize)return E(5),!1;if(0>a.opts.imageAllowedTypes.indexOf(f.type.replace(/image\//g,
    "")))return E(6),!1;if(a.drag_support.formdata&&(d=a.drag_support.formdata?new FormData:null),d){var h;if(!1!==a.opts.imageUploadToS3)for(h in d.append("key",a.opts.imageUploadToS3.keyStart+(new Date).getTime()+"-"+(f.name||"untitled")),d.append("success_action_status","201"),d.append("X-Requested-With","xhr"),d.append("Content-Type",f.type),a.opts.imageUploadToS3.params)a.opts.imageUploadToS3.params.hasOwnProperty(h)&&d.append(h,a.opts.imageUploadToS3.params[h]);for(h in a.opts.imageUploadParams)a.opts.imageUploadParams.hasOwnProperty(h)&&
    d.append(h,a.opts.imageUploadParams[h]);d.append(a.opts.imageUploadParam,f,f.name);var l,m=a.opts.imageUploadURL,r=a.opts.imageUploadMethod;a.opts.imageUploadToS3&&(m=a.opts.imageUploadToS3.uploadURL?a.opts.imageUploadToS3.uploadURL:"https://".concat(a.opts.imageUploadToS3.region,".amazonaws.com/").concat(a.opts.imageUploadToS3.bucket));a.opts.imageUploadToAzure&&(l=m=a.opts.imageUploadToAzure.uploadURL?"".concat(a.opts.imageUploadToAzure.uploadURL,"/").concat(f.name):encodeURI("https://".concat(a.opts.imageUploadToAzure.account,
    ".blob.core.windows.net/").concat(a.opts.imageUploadToAzure.container,"/").concat(f.name)),a.opts.imageUploadToAzure.SASToken&&(m+=a.opts.imageUploadToAzure.SASToken),r="PUT");m=a.core.getXHR(m,r);if(a.opts.imageUploadToAzure){var q=(new Date).toUTCString();if(!a.opts.imageUploadToAzure.SASToken&&a.opts.imageUploadToAzure.accessKey){var n=a.opts.imageUploadToAzure.account;var v=a.opts.imageUploadToAzure.container;a.opts.imageUploadToAzure.uploadURL&&(n=a.opts.imageUploadToAzure.uploadURL.split("/"),
    v=n.pop(),n=n.pop().split(".")[0]);var D="x-ms-blob-type:BlockBlob\nx-ms-date:".concat(q,"\nx-ms-version:2019-07-07");v=encodeURI("/"+n+"/"+v+"/"+f.name);v=r=a.cryptoJSPlugin.cryptoJS.HmacSHA256(r+"\n\n\n"+f.size+"\n\n"+f.type+"\n\n\n\n\n\n\n"+D+"\n"+v,a.cryptoJSPlugin.cryptoJS.enc.Base64.parse(a.opts.imageUploadToAzure.accessKey)).toString(a.cryptoJSPlugin.cryptoJS.enc.Base64);m.setRequestHeader("Authorization","SharedKey "+n+":"+r)}for(h in m.setRequestHeader("x-ms-version","2019-07-07"),m.setRequestHeader("x-ms-date",
    q),m.setRequestHeader("Content-Type",f.type),m.setRequestHeader("x-ms-blob-type","BlockBlob"),a.opts.imageUploadParams)a.opts.imageUploadParams.hasOwnProperty(h)&&m.setRequestHeader(h,a.opts.imageUploadParams[h]);for(h in a.opts.imageUploadToAzure.params)a.opts.imageUploadToAzure.params.hasOwnProperty(h)&&m.setRequestHeader(h,a.opts.imageUploadToAzure.params[h])}!function(F,R,O,z,ha,Y){function ma(){var A=k(this);A.off("load");A.addClass("fr-uploading");A.next().is("br")&&A.next().remove();a.placeholder.refresh();
    B(A);K();G();a.edit.off();F.onload=function(){Fa.call(F,A,ha,Y)};F.onerror=Ga;F.upload.onprogress=Ha;F.onabort=Ia;k(A.off("abortUpload")).on("abortUpload",function(){4!=F.readyState&&(F.abort(),z?(z.attr("src",z.data("fr-old-src")),z.removeClass("fr-uploading")):A.remove(),y(!0))});F.send(a.opts.imageUploadToAzure?O:R)}var Z=new FileReader;Z.onload=function(){var A=Z.result;if(0>Z.result.indexOf("svg+xml")){A=atob(Z.result.split(",")[1]);for(var xa=[],na=0;na<A.length;na++)xa.push(A.charCodeAt(na));
    A=window.URL.createObjectURL(new Blob([new Uint8Array(xa)],{type:"image/jpeg"}))}z?(z.on("load",ma),z.on("error",function(){ma();k(this).off("error")}),a.edit.on(),a.undo.saveStep(),z.data("fr-old-src",z.attr("src")),z.attr("src",A)):wa(A,null,ma)};Z.readAsDataURL(O)}(m,d,f,c||e,l,v)}}}function Ja(b){if(b.is("img")&&0<b.parents(".fr-img-caption").length)return b.parents(".fr-img-caption")}function Ka(b){var c=b.originalEvent.dataTransfer;if(c&&c.files&&c.files.length){var d=c.files[0];if(d&&d.type&&
    -1!==d.type.indexOf("image")&&0<=a.opts.imageAllowedTypes.indexOf(d.type.replace(/image\//g,""))){if(!a.opts.imageUpload)return b.preventDefault(),b.stopPropagation(),!1;a.markers.remove();a.markers.insertAtPoint(b.originalEvent);a.$el.find(".fr-marker").replaceWith(g.MARKERS);0===a.$el.find(".fr-marker").length&&a.selection.setAtEnd(a.el);a.popups.hideAll();a.popups.get("image.insert")||V();a.popups.setContainer("image.insert",a.$sc);var f=b.originalEvent.pageX,h=b.originalEvent.pageY;if(a.opts.iframe){var l=
    a.helpers.getPX(a.$wp.find(".fr-iframe").css("padding-top")),m=a.helpers.getPX(a.$wp.find(".fr-iframe").css("padding-left"));h+=a.$iframe.offset().top+l;f+=a.$iframe.offset().left+m}return a.popups.show("image.insert",f,h),G(),0<=a.opts.imageAllowedTypes.indexOf(d.type.replace(/image\//g,""))?(y(!0),fa(c.files)):E(6),b.preventDefault(),b.stopPropagation(),!1}}}function V(b){if(b)return a.popups.onRefresh("image.insert",p),a.popups.onHide("image.insert",I),!0;var c,d;b="";a.opts.imageUpload||-1===
    a.opts.imageInsertButtons.indexOf("imageUpload")||a.opts.imageInsertButtons.splice(a.opts.imageInsertButtons.indexOf("imageUpload"),1);var f=a.button.buildList(a.opts.imageInsertButtons);""!==f&&(b='<div class="fr-buttons fr-tabs">'.concat(f,"</div>"));f=a.opts.imageInsertButtons.indexOf("imageUpload");var h=a.opts.imageInsertButtons.indexOf("imageByURL"),l="";0<=f&&(c=" fr-active",0<=h&&h<f&&(c=""),l='<div class="fr-image-upload-layer'.concat(c,' fr-layer" id="fr-image-upload-layer-').concat(a.id,
    '"><strong>').concat(a.language.translate("Drop image"),"</strong><br>(").concat(a.language.translate("or click"),')<div class="fr-form"><input type="file" accept="image/').concat(a.opts.imageAllowedTypes.join(", image/").toLowerCase(),'" tabIndex="-1" aria-labelledby="fr-image-upload-layer-').concat(a.id,'" role="button"></div></div>'));var m="";0<=h&&(c=" fr-active",0<=f&&f<h&&(c=""),m='<div class="fr-image-by-url-layer'.concat(c,' fr-layer" id="fr-image-by-url-layer-').concat(a.id,'"><div class="fr-input-line"><input id="fr-image-by-url-layer-text-').concat(a.id,
    '" type="text" placeholder="http://" tabIndex="1" aria-required="true"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageInsertByURL" tabIndex="2" role="button">').concat(a.language.translate("Insert"),"</button></div></div>"));c={buttons:b,upload_layer:l,by_url_layer:m,progress_bar:'<div class="fr-image-progress-bar-layer fr-layer"><h3 tabIndex="-1" class="fr-message">Uploading</h3><div class="fr-loader"><span class="fr-progress"></span></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-dismiss" data-cmd="imageDismissError" tabIndex="2" role="button">OK</button></div></div>'};
    return 1<=a.opts.imageInsertButtons.length&&(d=a.popups.create("image.insert",c)),a.$wp&&a.events.$on(a.$wp,"scroll",function(){e&&a.popups.isVisible("image.insert")&&ca()}),function(r){a.events.$on(r,"dragover dragenter",".fr-image-upload-layer",function(q){return k(this).addClass("fr-drop"),(a.browser.msie||a.browser.edge)&&q.preventDefault(),!1},!0);a.events.$on(r,"dragleave dragend",".fr-image-upload-layer",function(q){return k(this).removeClass("fr-drop"),(a.browser.msie||a.browser.edge)&&q.preventDefault(),
    !1},!0);a.events.$on(r,"drop",".fr-image-upload-layer",function(q){q.preventDefault();q.stopPropagation();k(this).removeClass("fr-drop");if((q=q.originalEvent.dataTransfer)&&q.files){var n=r.data("instance")||a;n.events.disableBlur();n.image.upload(q.files);n.events.enableBlur()}},!0);a.helpers.isIOS()&&a.events.$on(r,"touchstart",'.fr-image-upload-layer input[type="file"]',function(){k(this).trigger("click")},!0);a.events.$on(r,"change",'.fr-image-upload-layer input[type="file"]',function(){if(this.files){var q=
    r.data("instance")||a;q.events.disableBlur();r.find("input:focus").blur();q.events.enableBlur();q.image.upload(this.files,e)}k(this).val("")},!0)}(d),d}function La(){e&&a.popups.get("image.alt").find("input").val(e.attr("alt")||"").trigger("change")}function ya(){a.popups.get("image.alt")||za();N();a.popups.refresh("image.alt");a.popups.setContainer("image.alt",a.$sc);var b=w();x()&&(b=b.find(".fr-img-wrap"));var c=b.offset().left+b.outerWidth()/2,d=b.offset().top+b.outerHeight();a.popups.show("image.alt",
    c,d,b.outerHeight(),!0)}function za(b){if(b)return a.popups.onRefresh("image.alt",La),!0;b={buttons:'<div class="fr-buttons fr-tabs">'.concat(a.button.buildList(a.opts.imageAltButtons),"</div>"),alt_layer:'<div class="fr-image-alt-layer fr-layer fr-active" id="fr-image-alt-layer-'.concat(a.id,'"><div class="fr-input-line"><input id="fr-image-alt-layer-text-').concat(a.id,'" type="text" placeholder="').concat(a.language.translate("Alternative Text"),'" tabIndex="1"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageSetAlt" tabIndex="2" role="button">').concat(a.language.translate("Update"),
    "</button></div></div>")};b=a.popups.create("image.alt",b);return a.$wp&&a.events.$on(a.$wp,"scroll.image-alt",function(){e&&a.popups.isVisible("image.alt")&&ya()}),b}function Ma(){var b=a.popups.get("image.size"),c=e.get(0).style.height?e.get(0).style.height:"auto",d=e.get(0).style.width?e.get(0).style.width:"auto";e&&(x()&&(e.parent().get(0).style.width||e.parent().parent()),b.find('input[name="width"]').val(d).trigger("change"),b.find('input[name="height"]').val(c).trigger("change"))}function Aa(){a.popups.get("image.size")||
    Ba();N();a.popups.refresh("image.size");a.popups.setContainer("image.size",a.$sc);var b=w();x()&&(b=b.find(".fr-img-wrap"));var c=b.offset().left+b.outerWidth()/2,d=b.offset().top+b.outerHeight();a.popups.show("image.size",c,d,b.outerHeight(),!0)}function Ba(b){if(b)return a.popups.onRefresh("image.size",Ma),!0;b={buttons:'<div class="fr-buttons fr-tabs">'.concat(a.button.buildList(a.opts.imageSizeButtons),"</div>"),size_layer:'<div class="fr-image-size-layer fr-layer fr-active" id="fr-image-size-layer-'.concat(a.id,
    '"><div class="fr-image-group"><div class="fr-input-line"><input id="fr-image-size-layer-width-\'').concat(a.id,'" type="text" name="width" placeholder="').concat(a.language.translate("Width"),'" tabIndex="1"></div><div class="fr-input-line"><input id="fr-image-size-layer-height').concat(a.id,'" type="text" name="height" placeholder="').concat(a.language.translate("Height"),'" tabIndex="1"></div></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageSetSize" tabIndex="2" role="button">').concat(a.language.translate("Update"),
    "</button></div></div>")};b=a.popups.create("image.size",b);return a.$wp&&a.events.$on(a.$wp,"scroll.image-size",function(){e&&a.popups.isVisible("image.size")&&Aa()}),b}function sa(b,c,d,f){return b.pageX=c,qa.call(this,b),b.pageX+=d*Math.floor(Math.pow(1.1,f)),ra.call(this,b),la.call(this,b),++f}function ea(b){(b=b||w())&&!1!==a.events.trigger("image.beforeRemove",[b])&&(a.popups.hideAll(),S(),y(!0),a.undo.canDo()||a.undo.saveStep(),b.get(0)==a.el?b.removeAttr("src"):(b.get(0).parentNode&&"A"==
    b.get(0).parentNode.tagName?(a.selection.setBefore(b.get(0).parentNode)||a.selection.setAfter(b.get(0).parentNode)||b.parent().after(g.MARKERS),k(b.get(0).parentNode).remove()):(a.selection.setBefore(b.get(0))||a.selection.setAfter(b.get(0))||b.after(g.MARKERS),b.remove()),a.html.fillEmptyBlocks(),a.selection.restore()),a.undo.saveStep())}function Ca(b){var c=b.which;if(e&&(c==g.KEYCODE.BACKSPACE||c==g.KEYCODE.DELETE))return b.preventDefault(),b.stopPropagation(),ea(),!1;if(e&&c==g.KEYCODE.ESC)return c=
    e,y(!0),a.selection.setAfter(c.get(0)),a.selection.restore(),b.preventDefault(),!1;if(!e||c!=g.KEYCODE.ARROW_LEFT&&c!=g.KEYCODE.ARROW_RIGHT)return e&&c===g.KEYCODE.TAB?(b.preventDefault(),b.stopPropagation(),y(!0),!1):e&&c!=g.KEYCODE.F10&&!a.keys.isBrowserAction(b)?(b.preventDefault(),b.stopPropagation(),!1):void 0;var d=e.get(0);return y(!0),c==g.KEYCODE.ARROW_LEFT?a.selection.setBefore(d):a.selection.setAfter(d),a.selection.restore(),b.preventDefault(),!1}function Da(b){if(b&&"IMG"==b.tagName){if(a.node.hasClass(b,
    "fr-uploading")||a.node.hasClass(b,"fr-error")?b.parentNode.removeChild(b):a.node.hasClass(b,"fr-draggable")&&b.classList.remove("fr-draggable"),b.parentNode&&b.parentNode.parentNode&&a.node.hasClass(b.parentNode.parentNode,"fr-img-caption")){var c=b.parentNode.parentNode;c.removeAttribute("contenteditable");c.removeAttribute("draggable");c.classList.remove("fr-draggable");(b=b.nextSibling)&&b.removeAttribute("contenteditable")}}else if(b&&b.nodeType==Node.ELEMENT_NODE)for(b=b.querySelectorAll("img.fr-uploading, img.fr-error, img.fr-draggable"),
    c=0;c<b.length;c++)Da(b[c])}function Ea(b){if(!1===a.events.trigger("image.beforePasteUpload",[b]))return!1;e=k(b);K();t();ca();G();e.on("load",function(){var h=[];K();1>k(a.popups.get("image.insert").get(0)).find("div.fr-active.fr-error").length&&G();k(this).data("events").find(function(l){"load"===l[0]&&h.push(l)});1>=h.length&&k(this).off("load")});b=k(b).attr("src").split(",");for(var c=atob(b[1]),d=[],f=0;f<c.length;f++)d.push(c.charCodeAt(f));fa([new Blob([new Uint8Array(d)],{type:b[0].replace(/data:/g,
    "").replace(/;base64/g,"")})],e)}function Na(){a.opts.imagePaste?a.$el.find("img[data-fr-image-pasted]").each(function(b,c){if(a.opts.imagePasteProcess){var d=a.opts.imageDefaultWidth;d&&"auto"!=d&&(d+=a.opts.imageResizeWithPercent?"%":"px");k(c).css("width",d).removeClass("fr-dii fr-dib fr-fir fr-fil");P(k(c),a.opts.imageDefaultDisplay,a.opts.imageDefaultAlign)}0===c.src.indexOf("data:")?Ea(c):0===c.src.indexOf("blob:")||0===c.src.indexOf("http")&&a.opts.imageUploadRemoteUrls&&a.opts.imageCORSProxy?
    (d=new Image,d.crossOrigin="Anonymous",d.onload=function(){var f=a.o_doc.createElement("CANVAS"),h=f.getContext("2d");f.height=this.naturalHeight;f.width=this.naturalWidth;h.drawImage(this,0,0);setTimeout(function(){Ea(c)},0);c.src=f.toDataURL("image/".concat(2E3<this.naturalWidth||1500<this.naturalHeight?"jpeg":"png"))},d.src=(0===c.src.indexOf("blob:")?"":"".concat(a.opts.imageCORSProxy,"/"))+c.src):0!==c.src.indexOf("http")||0===c.src.indexOf("https://mail.google.com/mail")?(a.selection.save(),
    k(c).remove(),a.selection.restore()):k(c).removeAttr("data-fr-image-pasted")}):a.$el.find("img[data-fr-image-pasted]").remove()}function Oa(b){b=b.target.result;var c=a.opts.imageDefaultWidth;c&&"auto"!=c&&(c+=a.opts.imageResizeWithPercent?"%":"px");a.undo.saveStep();a.html.insert('<img data-fr-image-pasted="true" src="'.concat(b,'"').concat(c?' style="width: '.concat(c,';"'):"",">"));(b=a.$el.find('img[data-fr-image-pasted="true"]'))&&P(b,a.opts.imageDefaultDisplay,a.opts.imageDefaultAlign);a.events.trigger("paste.after")}
    function Pa(b){if(b&&b.clipboardData&&b.clipboardData.items){var c=null;if(b.clipboardData.types&&-1!=[].indexOf.call(b.clipboardData.types,"text/rtf")||b.clipboardData.getData("text/rtf"))c=b.clipboardData.items[0].getAsFile();else for(var d=0;d<b.clipboardData.items.length&&!(c=b.clipboardData.items[d].getAsFile());d++);if(c)return b=c,c=new FileReader,c.onload=Oa,c.readAsDataURL(b),!1}}function Qa(b){return b.replace(/<img /gi,'<img data-fr-image-pasted="true" ')}function ua(b){if("false"==k(this).parents("[contenteditable]").not(".fr-element").not(".fr-img-caption").not("body").first().attr("contenteditable")||
    b&&"touchend"==b.type&&oa)return!0;if(b&&a.edit.isDisabled())return b.stopPropagation(),b.preventDefault(),!1;for(var c=0;c<g.INSTANCES.length;c++)g.INSTANCES[c]!=a&&g.INSTANCES[c].events.trigger("image.hideResizer");a.toolbar.disable();b&&(b.stopPropagation(),b.preventDefault());a.helpers.isMobile()&&(a.events.disableBlur(),a.$el.blur(),a.events.enableBlur());a.opts.iframe&&a.size.syncIframe();e=k(this);S();K();t();a.browser.msie?(a.popups.areVisible()&&a.events.disableBlur(),a.win.getSelection&&
    (a.win.getSelection().removeAllRanges(),a.win.getSelection().addRange(a.doc.createRange()))):a.selection.clear();a.helpers.isIOS()&&(a.events.disableBlur(),a.$el.blur());a.button.bulkRefresh();a.events.trigger("video.hideResizer")}function y(b){e&&(Q||!0===b)&&(a.toolbar.enable(),u.removeClass("fr-active"),a.popups.hideAll(),e=null,Q=!1,C=null,H&&H.hide())}function Ra(){Q=!0}function Sa(){Q=!1}function P(b,c,d){!a.opts.htmlUntouched&&a.opts.useClasses?(b.removeClass("fr-fil fr-fir fr-dib fr-dii"),
    d&&b.addClass("fr-fi".concat(d[0])),c&&b.addClass("fr-di".concat(c[0])),a.opts.imageDefaultMargin&&b.css({margin:a.opts.imageDefaultMargin})):"inline"==c?(b.css({display:"inline-block",verticalAlign:"bottom",margin:a.opts.imageDefaultMargin}),"center"==d?b.css({"float":"none",marginBottom:"",marginTop:"",maxWidth:"calc(100% - ".concat(2*a.opts.imageDefaultMargin,"px)"),textAlign:"center"}):"left"==d?b.css({"float":"left",marginLeft:0,maxWidth:"calc(100% - ".concat(a.opts.imageDefaultMargin,"px)"),
    textAlign:"left"}):b.css({"float":"right",marginRight:0,maxWidth:"calc(100% - ".concat(a.opts.imageDefaultMargin,"px)"),textAlign:"right"})):"block"==c&&(b.css({display:"block","float":"none",verticalAlign:"top",margin:"".concat(a.opts.imageDefaultMargin,"px auto"),textAlign:"center"}),"left"==d?b.css({marginLeft:0,textAlign:"left"}):"right"==d&&b.css({marginRight:0,textAlign:"right"}))}function T(b){if(void 0===b&&(b=w()),b){if(b.hasClass("fr-fil"))return"left";if(b.hasClass("fr-fir"))return"right";
    if(b.hasClass("fr-dib")||b.hasClass("fr-dii"))return"center";var c=b.css("float");if(b.css("float","none"),"block"==b.css("display")){if(b.css("float",""),b.css("float")!=c&&b.css("float",c),0===parseInt(b.css("margin-left"),10))return"left";if(0===parseInt(b.css("margin-right"),10))return"right"}else{if(b.css("float",""),b.css("float")!=c&&b.css("float",c),"left"==b.css("float"))return"left";if("right"==b.css("float"))return"right"}}return"center"}function ka(b){void 0===b&&(b=w());var c=b.css("float");
    return b.css("float","none"),"block"==b.css("display")?(b.css("float",""),b.css("float")!=c&&b.css("float",c),"block"):(b.css("float",""),b.css("float")!=c&&b.css("float",c),"inline")}function ca(){a.popups.get("image.insert")||V();a.popups.isVisible("image.insert")||(N(),a.popups.refresh("image.insert"),a.popups.setContainer("image.insert",a.$sc));var b=w();x()&&(b=b.find(".fr-img-wrap"));var c=b.offset().left+b.outerWidth()/2,d=b.offset().top+b.outerHeight();a.popups.show("image.insert",c,d,b.outerHeight(!0),
    !0)}function S(){if(e){a.events.disableBlur();a.selection.clear();var b=a.doc.createRange();b.selectNode(e.get(0));a.browser.msie&&b.collapse(!0);a.selection.get().addRange(b);a.events.enableBlur()}}function w(){return x()?e.parents(".fr-img-caption").first():e}function x(){return!!e&&0<e.parents(".fr-img-caption").length}function ia(b){for(var c=document.createDocumentFragment();b.firstChild;){var d=b.removeChild(b.firstChild);c.appendChild(d)}b.parentNode.replaceChild(c,b)}var e,u,C,H,J,oa,k=a.$,
    ja=!1,da={1:"Image cannot be loaded from the passed link.",2:"No link in upload response.",3:"Error during file upload.",4:"Parsing response failed.",5:"File is too large.",6:"Image file type is invalid.",7:"Files can be uploaded only to same domain in IE 8 and IE 9."},Q=!(da[8]="Image file is corrupted.");return{_init:function(){var b;(function(){a.events.$on(a.$el,a._mousedown,"IMG"==a.el.tagName?null:'img:not([contenteditable="false"])',function(c){if("false"==k(this).parents("contenteditable").not(".fr-element").not(".fr-img-caption").not("body").first().attr("contenteditable"))return!0;
    a.helpers.isMobile()||a.selection.clear();ja=!0;a.popups.areVisible()&&a.events.disableBlur();a.browser.msie&&(a.events.disableBlur(),a.$el.attr("contenteditable",!1));a.draggable||"touchstart"==c.type||c.preventDefault();c.stopPropagation()});a.events.$on(a.$el,a._mousedown,".fr-img-caption .fr-inner",function(c){a.core.hasFocus()||a.events.focus();c.stopPropagation()});a.events.$on(a.$el,"paste",".fr-img-caption .fr-inner",function(c){a.toolbar.hide();c.stopPropagation()});a.events.$on(a.$el,a._mouseup,
    "IMG"==a.el.tagName?null:'img:not([contenteditable="false"])',function(c){if("false"==k(this).parents("contenteditable").not(".fr-element").not(".fr-img-caption").not("body").first().attr("contenteditable"))return!0;ja&&(ja=!1,c.stopPropagation(),a.browser.msie&&(a.$el.attr("contenteditable",!0),a.events.enableBlur()))});a.events.on("keyup",function(c){if(c.shiftKey&&""===a.selection.text().replace(/\n/g,"")&&a.keys.isArrow(c.which)){c=a.selection.element();var d=a.selection.endElement();c&&"IMG"==
    c.tagName?B(k(c)):d&&"IMG"==d.tagName&&B(k(d))}},!0);a.events.on("drop",Ka);a.events.on("element.beforeDrop",Ja);a.events.on("mousedown window.mousedown",Ra);a.events.on("window.touchmove",Sa);a.events.on("mouseup window.mouseup",function(){if(e)return y(),!1;Q=!1});a.events.on("commands.mousedown",function(c){0<c.parents(".fr-toolbar").length&&y()});a.events.on("image.resizeEnd",function(){a.opts.iframe&&a.size.syncIframe()});a.events.on("blur image.hideResizer commands.undo commands.redo element.dropped",
    function(){y(!(ja=!1))});a.events.on("modals.hide",function(){e&&(S(),a.selection.clear())});a.events.on("image.resizeEnd",function(){a.win.getSelection&&B(e)});a.opts.imageAddNewLine&&a.events.on("image.inserted",function(c){var d=c.get(0);for(d.nextSibling&&"BR"===d.nextSibling.tagName&&(d=d.nextSibling);d&&!a.node.isElement(d);)d=a.node.isLastSibling(d)?d.parentNode:null;a.node.isElement(d)&&(a.opts.enter===g.ENTER_BR?c.after("<br>"):k(a.node.blockParent(c.get(0))).after("<".concat(a.html.defaultTag(),
    "><br></").concat(a.html.defaultTag(),">")))})})();"IMG"==a.el.tagName&&a.$el.addClass("fr-view");a.events.$on(a.$el,a.helpers.isMobile()&&!a.helpers.isWindowsPhone()?"touchend":"click","IMG"==a.el.tagName?null:'img:not([contenteditable="false"])',ua);a.helpers.isMobile()&&(a.events.$on(a.$el,"touchstart","IMG"==a.el.tagName?null:'img:not([contenteditable="false"])',function(){oa=!1}),a.events.$on(a.$el,"touchmove",function(){oa=!0}));a.$wp?(a.events.on("window.keydown keydown",Ca,!0),a.events.on("keyup",
    function(c){if(e&&c.which==g.KEYCODE.ENTER)return!1},!0),a.events.$on(a.$el,"keydown",function(){var c=a.selection.element();(c.nodeType===Node.TEXT_NODE||"BR"==c.tagName&&a.node.isLastSibling(c))&&(c=c.parentNode);a.node.hasClass(c,"fr-inner")||(a.node.hasClass(c,"fr-img-caption")||(c=k(c).parents(".fr-img-caption").get(0)),a.node.hasClass(c,"fr-img-caption")&&(k(c).after(g.INVISIBLE_SPACE+g.MARKERS),a.selection.restore()))})):a.events.$on(a.$win,"keydown",Ca);a.events.on("toolbar.esc",function(){if(e){if(a.$wp)a.events.disableBlur(),
    a.events.focus();else{var c=e;y(!0);a.selection.setAfter(c.get(0));a.selection.restore()}return!1}},!0);a.events.on("toolbar.focusEditor",function(){if(e)return!1},!0);a.events.on("window.cut window.copy",function(c){if(e&&a.popups.isVisible("image.edit")&&!a.popups.get("image.edit").find(":focus").length){var d=w();x()?(d.before(g.START_MARKER),d.after(g.END_MARKER),a.selection.restore(),a.paste.saveCopiedText(d.get(0).outerHTML,d.text())):(S(),a.paste.saveCopiedText(e.get(0).outerHTML,e.attr("alt")));
    "copy"==c.type?setTimeout(function(){B(e)}):(y(!0),a.undo.saveStep(),setTimeout(function(){a.undo.saveStep()},0))}},!0);a.browser.msie&&a.events.on("keydown",function(c){if(!a.selection.isCollapsed()||!e)return!0;var d=c.which;d==g.KEYCODE.C&&a.keys.ctrlKey(c)?a.events.trigger("window.copy"):d==g.KEYCODE.X&&a.keys.ctrlKey(c)&&a.events.trigger("window.cut")});a.events.$on(k(a.o_win),"keydown",function(c){var d=c.which;if(e&&d==g.KEYCODE.BACKSPACE)return c.preventDefault(),!1});a.events.$on(a.$win,
    "keydown",function(c){c=c.which;e&&e.hasClass("fr-uploading")&&c==g.KEYCODE.ESC&&e.trigger("abortUpload")});a.events.on("destroy",function(){e&&e.hasClass("fr-uploading")&&e.trigger("abortUpload")});a.events.on("paste.before",Pa);a.events.on("paste.beforeCleanup",Qa);a.events.on("paste.after",Na);a.events.on("html.set",L);a.events.on("html.inserted",L);L();a.events.on("destroy",function(){J=[]});a.events.on("html.processGet",Da);a.opts.imageOutputSize&&a.events.on("html.beforeGet",function(){b=a.el.querySelectorAll("img");
    for(var c=0;c<b.length;c++){var d=b[c].style.width||k(b[c]).width(),f=b[c].style.height||k(b[c]).height();d&&b[c].setAttribute("width","".concat(d).replace(/px/,""));f&&b[c].setAttribute("height","".concat(f).replace(/px/,""))}});a.opts.iframe&&a.events.on("image.loaded",a.size.syncIframe);a.$wp&&(aa(),a.events.on("contentChanged",aa));a.events.$on(k(a.o_win),"orientationchange.image",function(){setTimeout(function(){e&&B(e)},100)});pa(!0);V(!0);Ba(!0);za(!0);a.events.on("node.remove",function(c){if("IMG"==
    c.get(0).tagName)return ea(c),!1})},showInsertPopup:function(){var b=a.$tb.find('.fr-command[data-cmd="insertImage"]'),c=a.popups.get("image.insert");(c||(c=V()),N(),c.hasClass("fr-active"))||((a.popups.refresh("image.insert"),a.popups.setContainer("image.insert",a.$tb),b.isVisible())?(c=a.button.getPosition(b),a.popups.show("image.insert",c.left,c.top,b.outerHeight())):(a.position.forSelection(c),a.popups.show("image.insert")))},showLayer:function(b){var c=a.popups.get("image.insert");if(e||a.opts.toolbarInline){if(e){var d=
    w();x()&&(d=d.find(".fr-img-wrap"));var f=d.offset().top+d.outerHeight();d=d.offset().left}}else f=a.$tb.find('.fr-command[data-cmd="insertImage"]'),d=f.offset().left,f=f.offset().top+(a.opts.toolbarBottom?10:f.outerHeight()-10);!e&&a.opts.toolbarInline&&(f=c.offset().top-a.helpers.getPX(c.css("margin-top")),c.hasClass("fr-above")&&(f+=c.outerHeight()));c.find(".fr-layer").removeClass("fr-active");c.find(".fr-".concat(b,"-layer")).addClass("fr-active");a.popups.show("image.insert",d,f,e?e.outerHeight():
    0);a.accessibility.focusPopup(c)},refreshUploadButton:function(b){var c=a.popups.get("image.insert");c&&c.find(".fr-image-upload-layer").hasClass("fr-active")&&b.addClass("fr-active").attr("aria-pressed",!0)},refreshByURLButton:function(b){var c=a.popups.get("image.insert");c&&c.find(".fr-image-by-url-layer").hasClass("fr-active")&&b.addClass("fr-active").attr("aria-pressed",!0)},upload:fa,insertByURL:function(){var b=a.popups.get("image.insert").find(".fr-image-by-url-layer input");if(0<b.val().length){G();
    W(a.language.translate("Loading image"));var c=b.val().trim();if(a.opts.imageUploadRemoteUrls&&a.opts.imageCORSProxy&&a.opts.imageUpload){var d=new XMLHttpRequest;d.onload=function(){200==this.status?fa([new Blob([this.response],{type:this.response.type||"image/png"})],e):E(1)};d.onerror=function(){X(c,!0,[],e)};d.open("GET","".concat(a.opts.imageCORSProxy,"/").concat(c),!0);d.responseType="blob";d.send()}else X(c,!0,[],e);b.val("");b.blur()}},align:function(b){var c=w();c.removeClass("fr-fir fr-fil");
    !a.opts.htmlUntouched&&a.opts.useClasses?"left"==b?c.addClass("fr-fil"):"right"==b&&c.addClass("fr-fir"):P(c,ka(),b);S();K();t();a.selection.clear()},refreshAlign:function(b){e&&b.find("> *").first().replaceWith(a.icon.create("image-align-".concat(T())))},refreshAlignOnShow:function(b,c){e&&c.find('.fr-command[data-param1="'.concat(T(),'"]')).addClass("fr-active").attr("aria-selected",!0)},display:function(b){var c=w();c.removeClass("fr-dii fr-dib");!a.opts.htmlUntouched&&a.opts.useClasses?"inline"==
    b?c.addClass("fr-dii"):"block"==b&&c.addClass("fr-dib"):P(c,b,T());S();K();t();a.selection.clear()},refreshDisplayOnShow:function(b,c){e&&c.find('.fr-command[data-param1="'.concat(ka(),'"]')).addClass("fr-active").attr("aria-selected",!0)},replace:ca,back:function(){e?(a.events.disableBlur(),k(".fr-popup input:focus").blur(),B(e)):(a.events.disableBlur(),a.selection.restore(),a.events.enableBlur(),a.popups.hide("image.insert"),a.toolbar.showInline())},get:function(){return e},getEl:w,insert:X,showProgressBar:G,
    remove:ea,hideProgressBar:N,applyStyle:function(b,c,d){if(void 0===c&&(c=a.opts.imageStyles),void 0===d&&(d=a.opts.imageMultipleStyles),!e)return!1;var f=w();d||(d=Object.keys(c),d.splice(d.indexOf(b),1),f.removeClass(d.join(" ")));"object"==M(c[b])?(f.removeAttr("style"),f.css(c[b].style)):f.toggleClass(b);B(e)},showAltPopup:ya,showSizePopup:Aa,setAlt:function(b){if(e){var c=a.popups.get("image.alt");e.attr("alt",b||c.find("input").val()||"");c.find("input:focus").blur();B(e)}},setSize:function(b,
    c){if(e){var d=a.popups.get("image.size");b=b||d.find('input[name="width"]').val()||"";c=c||d.find('input[name="height"]').val()||"";var f=/^[\d]+((px)|%)*$/g;e.removeAttr("width").removeAttr("height");b.match(f)?e.css("width",b):e.css("width","");c.match(f)?e.css("height",c):e.css("height","");x()&&(e.parents(".fr-img-caption").removeAttr("width").removeAttr("height"),b.match(f)?e.parents(".fr-img-caption").css("width",b):e.parents(".fr-img-caption").css("width",""),c.match(f)?e.parents(".fr-img-caption").css("height",
    c):e.parents(".fr-img-caption").css("height",""));d&&d.find("input:focus").blur();B(e)}},toggleCaption:function(){var b;if(e&&!x()){(b=e).parent().is("a")&&(b=e.parent());var c,d,f=e.parents("ul")&&0<e.parents("ul").length?e.parents("ul"):e.parents("ol")&&0<e.parents("ol").length?e.parents("ol"):[];if(0<f.length){var h=f.find("li").length,l=e.parents("li"),m=document.createElement("li");h-1===l.index()&&(f.append(m),m.innerHTML="&nbsp;")}b.attr("style")?d=-1<(c=b.attr("style").split(":")).indexOf("width")?
    c[c.indexOf("width")+1].replace(";",""):"":b.attr("width")&&(d=b.attr("width"));c=a.opts.imageResizeWithPercent?(-1<d.indexOf("px")?null:d)||"100%":e.width()+"px";b.wrap('<div class="fr-img-space-wrap"><span '+(a.browser.mozilla?"":'contenteditable="false"')+'class="fr-img-caption '+e.attr("class")+'" style="'+(a.opts.useClasses?"":b.attr("style"))+'" draggable="false"></span><p class="fr-img-space-wrap2">&nbsp;</p></div>');b.wrap('<span class="fr-img-wrap"></span>');e.after('<span class="fr-inner"'.concat(a.browser.mozilla?
    "":' contenteditable="true"',">").concat(g.START_MARKER).concat(a.language.translate("Image Caption")).concat(g.END_MARKER,"</span>"));e.parents(".fr-img-caption").css("width",c);1<e.parents(".fr-img-space-wrap").length&&(ia(document.querySelector(".fr-img-space-wrap")),ia(document.querySelector(".fr-img-space-wrap2")));y(!0);a.selection.restore()}else{if(b=w(),e.insertBefore(b),null!==b[0].querySelector("a")){f=b[0].querySelector("a");c=document.createElement("a");d=0;h=f.attributes;for(l=h.length;d<
    l;d++)f=h[d],c.setAttribute(f.nodeName,f.nodeValue);e.wrap(c)}e.attr("class",b.attr("class").replace("fr-img-caption","")).attr("style",b.attr("style"));b.remove();1<e.parents(".fr-img-space-wrap").length&&(ia(document.querySelector(".fr-img-space-wrap")),ia(document.querySelector(".fr-img-space-wrap2")));B(e)}},hasCaption:x,exitEdit:y,edit:B}};g.DefineIcon("insertImage",{NAME:"image",SVG_KEY:"insertImage"});g.RegisterShortcut(g.KEYCODE.P,"insertImage",null,"P");g.RegisterCommand("insertImage",{title:"Insert Image",
    undo:!1,focus:!0,refreshAfterCallback:!1,popup:!0,callback:function(){this.popups.isVisible("image.insert")?(this.$el.find(".fr-marker").length&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("image.insert")):this.image.showInsertPopup()},plugin:"image"});g.DefineIcon("imageUpload",{NAME:"upload",SVG_KEY:"upload"});g.RegisterCommand("imageUpload",{title:"Upload Image",undo:!1,focus:!1,toggle:!0,callback:function(){this.image.showLayer("image-upload")},refresh:function(a){this.image.refreshUploadButton(a)}});
    g.DefineIcon("imageByURL",{NAME:"link",SVG_KEY:"insertLink"});g.RegisterCommand("imageByURL",{title:"By URL",undo:!1,focus:!1,toggle:!0,callback:function(){this.image.showLayer("image-by-url")},refresh:function(a){this.image.refreshByURLButton(a)}});g.RegisterCommand("imageInsertByURL",{title:"Insert Image",undo:!0,refreshAfterCallback:!1,callback:function(){this.image.insertByURL()},refresh:function(a){this.image.get()?a.text(this.language.translate("Replace")):a.text(this.language.translate("Insert"))}});
    g.DefineIcon("imageDisplay",{NAME:"star",SVG_KEY:"imageDisplay"});g.RegisterCommand("imageDisplay",{title:"Display",type:"dropdown",options:{inline:"Inline",block:"Break Text"},callback:function(a,p){this.image.display(p)},refresh:function(a){this.opts.imageTextNear||a.addClass("fr-hidden")},refreshOnShow:function(a,p){this.image.refreshDisplayOnShow(a,p)}});g.DefineIcon("image-align",{NAME:"align-left",SVG_KEY:"alignLeft"});g.DefineIcon("image-align-left",{NAME:"align-left",SVG_KEY:"alignLeft"});
    g.DefineIcon("image-align-right",{NAME:"align-right",SVG_KEY:"alignRight"});g.DefineIcon("image-align-center",{NAME:"align-justify",SVG_KEY:"alignCenter"});g.DefineIcon("imageAlign",{NAME:"align-justify",SVG_KEY:"alignJustify"});g.RegisterCommand("imageAlign",{type:"dropdown",title:"Align",options:{left:"Align Left",center:"None",right:"Align Right"},html:function(){var a='<ul class="fr-dropdown-list" role="presentation">',p=g.COMMANDS.imageAlign.options,t;for(t in p)p.hasOwnProperty(t)&&(a+='<li role="presentation"><a class="fr-command fr-title" tabIndex="-1" role="option" data-cmd="imageAlign" data-param1="'.concat(t,
    '" title="').concat(this.language.translate(p[t]),'">').concat(this.icon.create("image-align-".concat(t)),'<span class="fr-sr-only">').concat(this.language.translate(p[t]),"</span></a></li>"));return a+"</ul>"},callback:function(a,p){this.image.align(p)},refresh:function(a){this.image.refreshAlign(a)},refreshOnShow:function(a,p){this.image.refreshAlignOnShow(a,p)}});g.DefineIcon("imageReplace",{NAME:"exchange",FA5NAME:"exchange-alt",SVG_KEY:"replaceImage"});g.RegisterCommand("imageReplace",{title:"Replace",
    undo:!1,focus:!1,popup:!0,refreshAfterCallback:!1,callback:function(){this.image.replace()}});g.DefineIcon("imageRemove",{NAME:"trash",SVG_KEY:"remove"});g.RegisterCommand("imageRemove",{title:"Remove",callback:function(){this.image.remove()}});g.DefineIcon("imageBack",{NAME:"arrow-left",SVG_KEY:"back"});g.RegisterCommand("imageBack",{title:"Back",undo:!1,focus:!1,back:!0,callback:function(){this.image.back()},refresh:function(a){this.$;this.image.get()||this.opts.toolbarInline?(a.removeClass("fr-hidden"),
    a.next(".fr-separator").removeClass("fr-hidden")):(a.addClass("fr-hidden"),a.next(".fr-separator").addClass("fr-hidden"))}});g.RegisterCommand("imageDismissError",{title:"OK",undo:!1,callback:function(){this.image.hideProgressBar(!0)}});g.DefineIcon("imageStyle",{NAME:"magic",SVG_KEY:"imageClass"});g.RegisterCommand("imageStyle",{title:"Style",type:"dropdown",html:function(){var a='<ul class="fr-dropdown-list" role="presentation">',p=this.opts.imageStyles,t;for(t in p)if(p.hasOwnProperty(t)){var I=
    p[t];"object"==M(I)&&(I=I.title);a+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="imageStyle" data-param1="'.concat(t,'">').concat(this.language.translate(I),"</a></li>")}return a+"</ul>"},callback:function(a,p){this.image.applyStyle(p)},refreshOnShow:function(a,p){var t=this.$,I=this.image.getEl();I&&p.find(".fr-command").each(function(){var L=t(this).data("param1");L=I.hasClass(L);t(this).toggleClass("fr-active",L).attr("aria-selected",L)})}});g.DefineIcon("imageAlt",
    {NAME:"info",SVG_KEY:"imageAltText"});g.RegisterCommand("imageAlt",{undo:!1,focus:!1,popup:!0,title:"Alternative Text",callback:function(){this.image.showAltPopup()}});g.RegisterCommand("imageSetAlt",{undo:!0,focus:!1,title:"Update",refreshAfterCallback:!1,callback:function(){this.image.setAlt()}});g.DefineIcon("imageSize",{NAME:"arrows-alt",SVG_KEY:"imageSize"});g.RegisterCommand("imageSize",{undo:!1,focus:!1,popup:!0,title:"Change Size",callback:function(){this.image.showSizePopup()}});g.RegisterCommand("imageSetSize",
    {undo:!0,focus:!1,title:"Update",refreshAfterCallback:!1,callback:function(){this.image.setSize()}});g.DefineIcon("imageCaption",{NAME:"commenting",FA5NAME:"comment-alt",SVG_KEY:"imageCaption"});g.RegisterCommand("imageCaption",{undo:!0,focus:!1,title:"Image Caption",refreshAfterCallback:!0,callback:function(){this.image.toggleCaption()},refresh:function(a){this.image.get()&&a.toggleClass("fr-active",this.image.hasCaption())}})});